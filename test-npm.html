<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SeaLink SDK æµ‹è¯•å¹³å° (NPM v0.2.3 è¿œç«¯æµ‹è¯•)</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      font-size: 14px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card h2 {
      color: #333;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #11998e;
      font-size: 18px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      color: #555;
      font-weight: 500;
      font-size: 13px;
    }

    input, textarea, select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      font-family: monospace;
      transition: border-color 0.3s;
    }

    input:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #11998e;
    }

    button {
      width: 100%;
      padding: 12px;
      background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-top: 10px;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(17, 153, 142, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    button.danger {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }

    button.danger:hover {
      box-shadow: 0 4px 12px rgba(231, 76, 60, 0.4);
    }

    .output {
      background: #f7fafc;
      border: 1px solid #e2e8f0;
      border-radius: 6px;
      padding: 15px;
      margin-top: 15px;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .status {
      padding: 8px 12px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      display: inline-block;
      margin-top: 10px;
    }

    .status.success {
      background: #d4edda;
      color: #155724;
    }

    .status.error {
      background: #f8d7da;
      color: #721c24;
    }

    .status.info {
      background: #d1ecf1;
      color: #0c5460;
    }

    .full-width {
      grid-column: 1 / -1;
    }

    .badge {
      display: inline-block;
      padding: 4px 8px;
      background: #11998e;
      color: white;
      border-radius: 4px;
      font-size: 11px;
      margin-right: 8px;
    }

    .badge.npm {
      background: #cb3837;
    }

    .badge.local {
      background: #f39c12;
    }

    .config-section {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 15px;
    }

    code {
      background: #2d3748;
      color: #68d391;
      padding: 2px 6px;
      border-radius: 3px;
      font-size: 12px;
    }

    .version-info {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }

    .api-list {
      margin-top: 8px;
      margin-left: 20px;
      font-size: 13px;
    }

    .api-list li {
      margin: 4px 0;
    }

    .btn-group {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸŒŠ SeaLink SDK æµ‹è¯•å¹³å° (NPM v0.2.3 è¿œç«¯æµ‹è¯•)</h1>
      <p class="subtitle">
        <span class="badge npm">NPM Remote</span>
        <span class="badge">@seaverse/conversation-sdk</span>
        <span class="badge">v0.2.3</span>
      </p>
      <p class="version-info">ä» npm è¿œç«¯åŠ è½½ï¼ŒéªŒè¯å‘å¸ƒåçš„åŒ…</p>
    </header>

    <div class="grid">
      <!-- SDK é…ç½® -->
      <div class="card">
        <h2>âš™ï¸ SDK é…ç½®</h2>
        <div class="config-section">
          <div class="form-group">
            <label>Environment</label>
            <select id="sdk-environment">
              <option value="dev" selected>dev</option>
              <option value="prod">prod</option>
            </select>
          </div>
          <div class="form-group">
            <label>Access Token</label>
            <input type="text" id="sdk-token" value="Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJjaG4iOiJzZWF2ZXJzZSIsInNjcCI6WyJsb2dpbiIsImFwaSIsImFjY291bnQiXSwicGF5bG9hZCI6eyJ1c2VyX2lkIjoiMUNXdEV3TG1rTDcza2dNWEt6WEJkSiIsInVzZXJuYW1lIjoiZGF0b3UiLCJlbWFpbCI6ImRhdG91QGhhaXlpLmFydCJ9LCJpc3MiOiJhdXRoLXNlcnZpY2UiLCJzdWIiOiIxQ1d0RXdMbWtMNzNrZ01YS3pYQmRKIiwiZXhwIjoxNzk5NTcyNDIzLCJuYmYiOjE3NjgwMzY0MjMsImlhdCI6MTc2ODAzNjQyMywianRpIjoiNzkxNDc2NDYtMWY2NS00Y2IxLWJkNmMtN2FjZTU0MjNjOTQxIn0.kXQ7X2M8EC6Ikvzpu_boZsLeNxNGROBGVQZX5qnwTQg" placeholder="your-access-token">
          </div>
        </div>
        <button id="init-sdk">åˆå§‹åŒ– SDK</button>
        <div id="sdk-status"></div>
      </div>

      <!-- SDK ä¿¡æ¯ -->
      <div class="card">
        <h2>ğŸ“¦ NPM åŒ…ä¿¡æ¯</h2>
        <div class="config-section">
          <p><strong>åŒ…åï¼š</strong><code>@seaverse/conversation-sdk</code></p>
          <p style="margin-top: 8px;"><strong>ç‰ˆæœ¬ï¼š</strong><code>0.2.3</code></p>
          <p style="margin-top: 8px;"><strong>æ¥æºï¼š</strong><code>npm è¿œç«¯ (esm.sh CDN)</code></p>
          <p style="margin-top: 8px;"><strong>å¯ç”¨ APIï¼š</strong></p>
          <ul class="api-list">
            <li><code>getConversationsList()</code> - è·å–ä¼šè¯åˆ—è¡¨</li>
            <li><code>getAppsWithConversationsList()</code> - è·å–åº”ç”¨èšåˆæ•°æ®</li>
            <li><code>getMessagesList()</code> - è·å–æ¶ˆæ¯åˆ—è¡¨</li>
            <li><code>createConversation()</code> - åˆ›å»ºä¼šè¯</li>
            <li><code>deleteConversation()</code> - åˆ é™¤ä¼šè¯</li>
          </ul>
        </div>
        <div id="npm-output" class="output" style="max-height: 150px;">ç­‰å¾… SDK åŠ è½½...</div>
      </div>

      <!-- è·å–ä¼šè¯åˆ—è¡¨ -->
      <div class="card">
        <h2>ğŸ“‹ getConversationsList</h2>
        <div class="config-section">
          <div class="form-group">
            <label>User IDï¼ˆå¯é€‰ï¼‰</label>
            <input type="text" id="list-user-id" value="1CWtEwLmkL73kgMXKzXBdJ" placeholder="user-id">
          </div>
          <div class="form-group">
            <label>App IDï¼ˆå¯é€‰ï¼‰</label>
            <input type="text" id="list-app-id" value="" placeholder="app-id">
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="form-group">
              <label>Page</label>
              <input type="number" id="list-page" value="1" min="1">
            </div>
            <div class="form-group">
              <label>Page Size</label>
              <input type="number" id="list-page-size" value="10" min="1" max="100">
            </div>
          </div>
        </div>
        <button id="get-conversations" disabled>è·å–ä¼šè¯åˆ—è¡¨</button>
        <div id="list-output" class="output"></div>
      </div>

      <!-- åˆ›å»ºä¼šè¯ -->
      <div class="card">
        <h2>â• createConversation</h2>
        <div class="config-section">
          <div class="form-group">
            <label>ä¼šè¯æ ‡é¢˜</label>
            <input type="text" id="create-title" value="æµ‹è¯•ä¼šè¯" placeholder="conversation title">
          </div>
          <div class="form-group">
            <label>App IDï¼ˆå¯é€‰ï¼‰</label>
            <input type="text" id="create-app-id" value="app-1769501930216-489ca672" placeholder="app-id">
          </div>
          <div class="form-group">
            <label>User ID</label>
            <input type="text" id="create-user-id" value="1CWtEwLmkL73kgMXKzXBdJ" placeholder="user-id">
          </div>
        </div>
        <button id="create-conversation" disabled>åˆ›å»ºä¼šè¯</button>
        <div id="create-output" class="output"></div>
      </div>

      <!-- åˆ é™¤ä¼šè¯ -->
      <div class="card">
        <h2>ğŸ—‘ï¸ deleteConversation</h2>
        <div class="config-section">
          <div class="form-group">
            <label>Conversation IDï¼ˆä»åˆ›å»ºç»“æœå¤åˆ¶ï¼‰</label>
            <input type="text" id="delete-conv-id" value="" placeholder="conversation-id">
          </div>
        </div>
        <button id="delete-conversation" class="danger" disabled>åˆ é™¤ä¼šè¯</button>
        <div id="delete-output" class="output"></div>
      </div>

      <!-- è·å–åº”ç”¨å’Œä¼šè¯èšåˆæ•°æ® -->
      <div class="card">
        <h2>ğŸ“± getAppsWithConversationsList</h2>
        <div class="config-section">
          <div class="form-group">
            <label>App IDï¼ˆå¯é€‰ï¼‰</label>
            <input type="text" id="apps-app-id" value="" placeholder="app-idï¼ˆç•™ç©ºè·å–å…¨éƒ¨ï¼‰">
          </div>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
            <div class="form-group">
              <label>Page</label>
              <input type="number" id="apps-page" value="1" min="1">
            </div>
            <div class="form-group">
              <label>Page Size</label>
              <input type="number" id="apps-page-size" value="10" min="1" max="100">
            </div>
          </div>
        </div>
        <button id="get-apps" disabled>è·å–åº”ç”¨èšåˆæ•°æ®</button>
        <div id="apps-output" class="output"></div>
      </div>

      <!-- è·å–æ¶ˆæ¯åˆ—è¡¨ -->
      <div class="card full-width">
        <h2>ğŸ’¬ getMessagesList</h2>
        <div class="config-section">
          <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px;">
            <div class="form-group">
              <label>Conversation IDï¼ˆå¿…å¡«ï¼‰</label>
              <input type="text" id="messages-conv-id" value="" placeholder="conversation-id">
            </div>
            <div class="form-group">
              <label>Page</label>
              <input type="number" id="messages-page" value="1" min="1">
            </div>
            <div class="form-group">
              <label>Page Size</label>
              <input type="number" id="messages-page-size" value="50" min="1" max="100">
            </div>
          </div>
        </div>
        <button id="get-messages" disabled>è·å–æ¶ˆæ¯åˆ—è¡¨</button>
        <div id="messages-output" class="output"></div>
      </div>

      <!-- ä¸€é”®æµ‹è¯• -->
      <div class="card full-width">
        <h2>ğŸ§ª ä¸€é”®æµ‹è¯•ï¼ˆå®Œæ•´ CRUD æµç¨‹ï¼‰</h2>
        <div class="config-section">
          <p>ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®å°†ä¾æ¬¡æ‰§è¡Œï¼šåˆ›å»ºä¼šè¯ â†’ æŸ¥è¯¢ä¼šè¯åˆ—è¡¨ â†’ åˆ é™¤ä¼šè¯</p>
        </div>
        <button id="run-full-test" disabled>è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <div id="test-output" class="output"></div>
      </div>
    </div>
  </div>

  <script type="module">
    // ============================================
    // ä»æœ¬åœ°æ„å»ºçš„ NPM åŒ…æµ‹è¯• SDK
    // ============================================

    let sdk = null;
    let initConversationSdk = null;

    // è¾…åŠ©å‡½æ•°
    function log(elementId, message, type = 'info') {
      const output = document.getElementById(elementId);
      const timestamp = new Date().toLocaleTimeString();
      const typeEmoji = {
        info: 'ğŸ“˜',
        success: 'âœ…',
        error: 'âŒ',
        warning: 'âš ï¸'
      };
      const line = `[${timestamp}] ${typeEmoji[type]} ${message}`;
      output.textContent = `${line}\n\n${output.textContent}`;
      console.log(`[${elementId}] ${line}`);
    }

    function showStatus(elementId, message, type = 'info') {
      const container = document.getElementById(elementId);
      const statusDiv = document.createElement('div');
      statusDiv.className = `status ${type}`;
      statusDiv.textContent = message;
      container.textContent = '';
      container.appendChild(statusDiv);
    }

    function safeStringify(value) {
      try {
        return JSON.stringify(value, null, 2);
      } catch {
        return String(value);
      }
    }

    function normalizeAccessToken(raw) {
      const text = String(raw || '').trim();
      if (!text) return '';
      return text.replace(/^Bearer\s+/i, '').trim();
    }

    /**
     * åŒæºä»£ç† fetch
     */
    async function proxyFetch(input, init) {
      const url = typeof input === 'string' ? input : (input && input.url ? input.url : String(input));
      if (url.startsWith('/') || url.startsWith(window.location.origin)) {
        return fetch(input, init);
      }
      if (!/^https?:\/\//i.test(url)) {
        return fetch(input, init);
      }
      
      const allowedHeaders = ['authorization', 'content-type', 'accept', 'prefer'];
      const filteredHeaders = {};
      
      if (init && init.headers) {
        const headers = init.headers instanceof Headers 
          ? Object.fromEntries(init.headers.entries())
          : init.headers;
        
        for (const [key, value] of Object.entries(headers)) {
          if (allowedHeaders.includes(key.toLowerCase())) {
            filteredHeaders[key] = value;
          }
        }
      }
      
      const proxied = `/_proxy?url=${encodeURIComponent(url)}`;
      return fetch(proxied, {
        ...init,
        headers: filteredHeaders,
      });
    }

    // ä» npm åŒ…åŠ è½½ SDKï¼ˆä¼˜å…ˆæœ¬åœ°ï¼Œå›é€€ CDNï¼‰
    async function loadSdk() {
      // 1. ä¼˜å…ˆå°è¯•æœ¬åœ°ä¸‹è½½çš„ npm åŒ…
      try {
        log('npm-output', 'æ­£åœ¨ä»æœ¬åœ° npm åŒ…åŠ è½½...', 'info');
        const module = await import('./npm-package/package/dist/index.js');
        
        log('npm-output', `æ¨¡å— keys: ${Object.keys(module).join(', ')}`, 'info');
        
        initConversationSdk = module.initConversationSdk;
        
        if (typeof initConversationSdk === 'function') {
          log('npm-output', `âœ… SDK ä»æœ¬åœ° npm åŒ… (v0.2.3) åŠ è½½æˆåŠŸï¼`, 'success');
          document.getElementById('init-sdk').disabled = false;
          return true;
        }
      } catch (error) {
        log('npm-output', `âš ï¸ æœ¬åœ°åŠ è½½å¤±è´¥: ${error.message}`, 'warning');
      }

      // 2. å›é€€åˆ° CDN
      const timestamp = Date.now();
      const cdnUrls = [
        `https://esm.sh/@seaverse/conversation-sdk@0.2.3?t=${timestamp}`,
        `https://cdn.jsdelivr.net/npm/@seaverse/conversation-sdk@0.2.3/dist/index.js`,
        `https://unpkg.com/@seaverse/conversation-sdk@0.2.3/dist/index.js`,
      ];

      for (const url of cdnUrls) {
        try {
          log('npm-output', `æ­£åœ¨ä» CDN åŠ è½½: ${url}`, 'info');
          
          const module = await import(url);
          
          log('npm-output', `æ¨¡å— keys: ${Object.keys(module).join(', ')}`, 'info');
          
          initConversationSdk = module.initConversationSdk 
            || module.default?.initConversationSdk 
            || module.default;
          
          if (typeof initConversationSdk === 'function') {
            log('npm-output', `âœ… SDK ä» CDN åŠ è½½æˆåŠŸï¼\næ¥æº: ${url}`, 'success');
            document.getElementById('init-sdk').disabled = false;
            return true;
          }
          
          log('npm-output', `âš ï¸ initConversationSdk ç±»å‹é”™è¯¯: ${typeof initConversationSdk}`, 'warning');
        } catch (error) {
          log('npm-output', `âš ï¸ CDN åŠ è½½å¤±è´¥: ${error.message}`, 'warning');
        }
      }

      log('npm-output', 'âŒ æ‰€æœ‰æ¥æºåŠ è½½å¤±è´¥', 'error');
      return false;
    }

    // å¯ç”¨æ‰€æœ‰æŒ‰é’®
    function enableAllButtons() {
      document.getElementById('get-conversations').disabled = false;
      document.getElementById('create-conversation').disabled = false;
      document.getElementById('delete-conversation').disabled = false;
      document.getElementById('get-apps').disabled = false;
      document.getElementById('get-messages').disabled = false;
      document.getElementById('run-full-test').disabled = false;
    }

    // åˆå§‹åŒ– SDK
    document.getElementById('init-sdk').addEventListener('click', async () => {
      const environment = document.getElementById('sdk-environment').value;
      const token = normalizeAccessToken(document.getElementById('sdk-token').value);

      if (!token) {
        showStatus('sdk-status', 'è¯·å¡«å†™ Access Token', 'error');
        return;
      }

      try {
        showStatus('sdk-status', 'æ­£åœ¨åˆå§‹åŒ– SDK...', 'info');

        sdk = initConversationSdk({
          environment,
          token,
          fetch: proxyFetch,
        });

        showStatus('sdk-status', 'âœ… SDK åˆå§‹åŒ–æˆåŠŸ', 'success');
        enableAllButtons();
        
        log('npm-output', `SDK å·²åˆå§‹åŒ– (ç¯å¢ƒ: ${environment})`, 'success');
      } catch (error) {
        showStatus('sdk-status', `âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
        console.error('åˆå§‹åŒ–é”™è¯¯:', error);
      }
    });

    // è·å–ä¼šè¯åˆ—è¡¨
    document.getElementById('get-conversations').addEventListener('click', async () => {
      if (!sdk) return;

      const userId = document.getElementById('list-user-id').value.trim();
      const appId = document.getElementById('list-app-id').value.trim();
      const page = Math.max(1, Number(document.getElementById('list-page').value || 1));
      const pageSize = Math.max(1, Number(document.getElementById('list-page-size').value || 10));

      try {
        log('list-output', 'æ­£åœ¨è·å–ä¼šè¯åˆ—è¡¨...', 'info');

        const result = await sdk.getConversationsList({
          userId: userId || undefined,
          appId: appId || undefined,
          page,
          pageSize,
        });

        log(
          'list-output',
          `âœ… è·å–æˆåŠŸ\ncount: ${result.data?.length ?? 0}\npagination: ${safeStringify(result.pagination)}\n\ndata:\n${safeStringify(result.data).slice(0, 3000)}`,
          'success'
        );
      } catch (error) {
        log('list-output', `âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
        console.error('è·å–ä¼šè¯åˆ—è¡¨é”™è¯¯:', error);
      }
    });

    // åˆ›å»ºä¼šè¯
    document.getElementById('create-conversation').addEventListener('click', async () => {
      if (!sdk) return;

      const title = document.getElementById('create-title').value.trim();
      const appId = document.getElementById('create-app-id').value.trim();
      const userId = document.getElementById('create-user-id').value.trim();

      if (!title) {
        log('create-output', 'è¯·è¾“å…¥ä¼šè¯æ ‡é¢˜', 'error');
        return;
      }

      try {
        log('create-output', 'æ­£åœ¨åˆ›å»ºä¼šè¯...', 'info');

        const result = await sdk.createConversation({
          title,
          appId: appId || null,
          userId,
        });

        // è‡ªåŠ¨å¡«å……åˆ°åˆ é™¤è¾“å…¥æ¡†
        document.getElementById('delete-conv-id').value = result.conversation_id;
        document.getElementById('messages-conv-id').value = result.conversation_id;

        log(
          'create-output',
          `âœ… åˆ›å»ºæˆåŠŸ\nconversation_id: ${result.conversation_id}\ntitle: ${result.title}\n\n${safeStringify(result)}`,
          'success'
        );
      } catch (error) {
        log('create-output', `âŒ åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
        console.error('åˆ›å»ºä¼šè¯é”™è¯¯:', error);
      }
    });

    // åˆ é™¤ä¼šè¯
    document.getElementById('delete-conversation').addEventListener('click', async () => {
      if (!sdk) return;

      const conversationId = document.getElementById('delete-conv-id').value.trim();

      if (!conversationId) {
        log('delete-output', 'è¯·è¾“å…¥ Conversation ID', 'error');
        return;
      }

      try {
        log('delete-output', `æ­£åœ¨åˆ é™¤ä¼šè¯ ${conversationId}...`, 'info');

        await sdk.deleteConversation(conversationId);

        log('delete-output', `âœ… åˆ é™¤æˆåŠŸ\nå·²åˆ é™¤: ${conversationId}`, 'success');
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('delete-conv-id').value = '';
      } catch (error) {
        log('delete-output', `âŒ åˆ é™¤å¤±è´¥: ${error.message}`, 'error');
        console.error('åˆ é™¤ä¼šè¯é”™è¯¯:', error);
      }
    });

    // è·å–åº”ç”¨èšåˆæ•°æ®
    document.getElementById('get-apps').addEventListener('click', async () => {
      if (!sdk) return;

      const appId = document.getElementById('apps-app-id').value.trim();
      const page = Math.max(1, Number(document.getElementById('apps-page').value || 1));
      const pageSize = Math.max(1, Number(document.getElementById('apps-page-size').value || 10));

      try {
        log('apps-output', 'æ­£åœ¨è·å–åº”ç”¨èšåˆæ•°æ®...', 'info');

        const result = await sdk.getAppsWithConversationsList({
          appId: appId || undefined,
          page,
          pageSize,
        });

        log(
          'apps-output',
          `âœ… è·å–æˆåŠŸ\napps: ${result.apps?.length ?? 0}\nhasMore: ${result.hasMore}\n\n${safeStringify(result).slice(0, 5000)}`,
          'success'
        );
      } catch (error) {
        log('apps-output', `âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
        console.error('è·å–åº”ç”¨èšåˆæ•°æ®é”™è¯¯:', error);
      }
    });

    // è·å–æ¶ˆæ¯åˆ—è¡¨
    document.getElementById('get-messages').addEventListener('click', async () => {
      if (!sdk) return;

      const conversationId = document.getElementById('messages-conv-id').value.trim();
      const page = Math.max(1, Number(document.getElementById('messages-page').value || 1));
      const pageSize = Math.max(1, Number(document.getElementById('messages-page-size').value || 50));

      if (!conversationId) {
        log('messages-output', 'è¯·è¾“å…¥ Conversation ID', 'error');
        return;
      }

      try {
        log('messages-output', `æ­£åœ¨è·å–ä¼šè¯ ${conversationId} çš„æ¶ˆæ¯åˆ—è¡¨...`, 'info');

        const result = await sdk.getMessagesList(conversationId, {
          page,
          pageSize,
        });

        log(
          'messages-output',
          `âœ… è·å–æˆåŠŸ\nmessages: ${result.messages?.length ?? 0}\nhasMore: ${result.hasMore}\n\n${safeStringify(result).slice(0, 5000)}`,
          'success'
        );
      } catch (error) {
        log('messages-output', `âŒ è·å–å¤±è´¥: ${error.message}`, 'error');
        console.error('è·å–æ¶ˆæ¯åˆ—è¡¨é”™è¯¯:', error);
      }
    });

    // ä¸€é”®æµ‹è¯•
    document.getElementById('run-full-test').addEventListener('click', async () => {
      if (!sdk) return;

      const userId = document.getElementById('create-user-id').value.trim();
      const appId = document.getElementById('create-app-id').value.trim();

      try {
        log('test-output', '========== å¼€å§‹å®Œæ•´æµ‹è¯• ==========', 'info');

        // 1. åˆ›å»ºä¼šè¯
        log('test-output', 'æ­¥éª¤ 1: åˆ›å»ºä¼šè¯...', 'info');
        const created = await sdk.createConversation({
          title: `æµ‹è¯•ä¼šè¯ ${Date.now()}`,
          appId: appId || null,
          userId,
        });
        log('test-output', `âœ… åˆ›å»ºæˆåŠŸ: ${created.conversation_id}`, 'success');

        // 2. æŸ¥è¯¢ä¼šè¯åˆ—è¡¨
        log('test-output', 'æ­¥éª¤ 2: æŸ¥è¯¢ä¼šè¯åˆ—è¡¨...', 'info');
        const list = await sdk.getConversationsList({
          userId,
          page: 1,
          pageSize: 5,
        });
        log('test-output', `âœ… æŸ¥è¯¢æˆåŠŸ: å…± ${list.data.length} æ¡è®°å½•`, 'success');

        // éªŒè¯æ–°åˆ›å»ºçš„ä¼šè¯åœ¨åˆ—è¡¨ä¸­
        const found = list.data.find(c => c.id === created.conversation_id);
        if (found) {
          log('test-output', `âœ… éªŒè¯æˆåŠŸ: æ–°ä¼šè¯å­˜åœ¨äºåˆ—è¡¨ä¸­`, 'success');
        } else {
          log('test-output', `âš ï¸ éªŒè¯è­¦å‘Š: æ–°ä¼šè¯æœªåœ¨åˆ—è¡¨ä¸­æ‰¾åˆ°ï¼ˆå¯èƒ½æ˜¯åˆ†é¡µåŸå› ï¼‰`, 'warning');
        }

        // 3. è·å–åº”ç”¨èšåˆæ•°æ®
        log('test-output', 'æ­¥éª¤ 3: è·å–åº”ç”¨èšåˆæ•°æ®...', 'info');
        const apps = await sdk.getAppsWithConversationsList({
          page: 1,
          pageSize: 5,
        });
        log('test-output', `âœ… è·å–æˆåŠŸ: å…± ${apps.apps.length} ä¸ªåº”ç”¨`, 'success');

        // 4. åˆ é™¤ä¼šè¯
        log('test-output', 'æ­¥éª¤ 4: åˆ é™¤ä¼šè¯...', 'info');
        await sdk.deleteConversation(created.conversation_id);
        log('test-output', `âœ… åˆ é™¤æˆåŠŸ: ${created.conversation_id}`, 'success');

        // 5. éªŒè¯åˆ é™¤
        log('test-output', 'æ­¥éª¤ 5: éªŒè¯åˆ é™¤...', 'info');
        const listAfterDelete = await sdk.getConversationsList({
          userId,
          page: 1,
          pageSize: 100,
        });
        const stillExists = listAfterDelete.data.find(c => c.id === created.conversation_id);
        if (!stillExists) {
          log('test-output', `âœ… éªŒè¯æˆåŠŸ: ä¼šè¯å·²è¢«åˆ é™¤`, 'success');
        } else {
          log('test-output', `âŒ éªŒè¯å¤±è´¥: ä¼šè¯ä»ç„¶å­˜åœ¨`, 'error');
        }

        log('test-output', '========== å®Œæ•´æµ‹è¯•é€šè¿‡ ==========', 'success');
      } catch (error) {
        log('test-output', `âŒ æµ‹è¯•å¤±è´¥: ${error.message}\n${error.stack || ''}`, 'error');
        console.error('å®Œæ•´æµ‹è¯•é”™è¯¯:', error);
      }
    });

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½ SDK
    loadSdk();

    console.log('SeaLink SDK æµ‹è¯•å¹³å° (NPM v0.2.3 è¿œç«¯æµ‹è¯•) å·²åŠ è½½');
  </script>
</body>
</html>
